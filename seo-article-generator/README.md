# クライアント企業メディア記事自動生成システム

Google スプレッドシートの見出しから、OpenAI API を使用して記事を自動生成し、Google ドキュメントに保存するシステムです。

## 機能

1. **キーワード自動取得（NEW）**: Google Search Console APIから検索キーワードデータを自動取得してスプレッドシートに出力
2. **見出しデータ取得**: Google スプレッドシートから記事の見出し構造を取得
3. **記事自動生成**: OpenAI GPT-4o を使用して、クライアント企業メディアのスタイルで**6,000文字程度**の記事を生成（画像挿入あり）
4. **自動保存**: 生成した記事を Google ドキュメントに自動保存
5. **ステータス管理**: スプレッドシートで処理状況を自動更新
6. **Cloud Run対応**: 高速・安定した記事生成（Cloud Run版推奨）

## セットアップ手順

### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. Google Cloud Console の設定

#### a) プロジェクトの作成
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成

#### b) API の有効化
以下の API を有効化してください：
- Google Sheets API
- Google Docs API
- Google Drive API
- Google Search Console API（キーワード取得機能を使う場合）

#### c) 認証情報の作成
1. 「認証情報」→「認証情報を作成」→「OAuth クライアント ID」
2. アプリケーションの種類: 「デスクトップアプリ」
3. 作成後、JSON ファイルをダウンロード
4. ダウンロードしたファイルを `credentials.json` にリネームしてプロジェクトフォルダに配置

### 3. OpenAI API キーの取得

1. [OpenAI Platform](https://platform.openai.com/) にログイン
2. API Keys ページでキーを作成
3. キーをコピー（後で使用）

### 4. 環境変数の設定

```bash
# .env.example をコピー
cp .env.example .env

# .env ファイルを編集して以下を設定
# - SPREADSHEET_ID: スプレッドシートのID
# - OPENAI_API_KEY: OpenAI API キー
```

### 5. スプレッドシートの準備

各記事を1つのシートとして作成します。シートは以下の構造で作成してください：

**シート構造:**

| 行 | A列 | B列 | C列 | D列 | E列 | F列 | G列 |
|----|-----|-----|-----|-----|-----|-----|-----|
| 1 | | | | | | | |
| 2 | | タイトル案（H1） | | | | （ステータス）| （URL） |
| 3 | メインKW: | キーワード | | | | | |
| 4 | 上位記事URL | URL1, URL2... | | | | | |
| 5 | 共起語: | | | | | | |
| 6 | 担当: | | | | | | |
| 7 | ▼構成案 | | | | | | |
| 8 | H階層 | 見出し文 | | | | | |
| 9 | H1 | 【2025年最新版】副業におすすめの資格10選... | | | | | |
| 10 | H2 | 資格を活かした副業が注目される理由 | | | | | |
| 11 | H3 | 会社員でも始めやすいスキル副業が増えている | | | | | |
| 12 | H3 | リスクを抑えて収入源を分散できる | | | | | |
| ... | ... | ... | | | | | |

**重要なポイント:**
- 2行目 B列: H1タイトルを記載
- 3行目 B列: メインキーワードを記載
- 9行目以降: 見出し構造（A列にH1/H2/H3、B列に見出しテキスト）
- F2列: ステータス（処理済み/未処理）※自動更新
- G2列: ドキュメントURL ※自動更新

各記事ごとに別々のシートを作成してください。スクリプトは自動的にすべてのシートを読み込み、未処理のシートを処理します。

## 使用方法

### 基本的な使い方

```bash
python article_automation.py
```

初回実行時：
1. ブラウザが自動的に開きます
2. Google アカウントでログイン
3. 権限を許可
4. 認証情報が `token.json` に保存されます（次回から自動認証）

### 処理の流れ

1. スプレッドシートのすべてのシートを読み込む
2. 各シートについて：
   - F2列のステータスを確認（「処理済み」の場合はスキップ）
   - 3行目B列からキーワードを取得
   - 9行目以降からH1、H2見出しを抽出
   - OpenAI API で約3,000文字の記事を生成
   - Google ドキュメントに保存
   - F2列に「処理済み」、G2列にドキュメントURLを記録

## ファイル構成

```
クライアント企業/
├── article_automation.py          # メインスクリプト
├── article_generation_prompt.txt  # 記事生成用プロンプト
├── requirements.txt               # 必要なパッケージ
├── .env                          # 環境変数（自分で作成）
├── .env.example                  # 環境変数の例
├── credentials.json              # Google API認証情報（自分で配置）
├── token.json                    # Google認証トークン（自動生成）
└── README.md                     # このファイル
```

## プロンプトのカスタマイズ

`article_generation_prompt.txt` を編集することで、記事の生成スタイルを変更できます。

現在の設定：
- **文字数**: 3,000文字程度（2,800～3,200文字）
- **画像**: なし（テキストのみ）
- **トーン**: 親切で指導的、具体的かつ実践的
- **構成**: H1 + H2（複数）+ H3（各H2に2～4個）+ まとめ

カスタマイズ可能な要素：
- 文字数の調整
- トーンや文体
- セクションの詳細度
- まとめ部分のテンプレート

## トラブルシューティング

### Google API の認証エラー
- `credentials.json` が正しく配置されているか確認
- Google Cloud Console で API が有効化されているか確認
- `token.json` を削除して再認証を試す

### OpenAI API のエラー
- API キーが正しいか確認
- OpenAI のアカウントに十分なクレジットがあるか確認
- レート制限に達していないか確認

### スプレッドシートが見つからない
- スプレッドシートの ID が正しいか確認（URLの`/d/`と`/edit`の間の文字列）
- スプレッドシートが上記の構造で作成されているか確認
- F2列にステータスが記載されているか確認（空白の場合は未処理として扱われる）
- スプレッドシートの共有設定を確認

## キーワード取得機能（NEW）

Search Console APIから検索キーワードデータを自動取得して、スプレッドシートに出力する機能が追加されました。

### セットアップ方法

詳しくは [SEARCH_CONSOLE_CLOUDRUN_SETUP.md](./SEARCH_CONSOLE_CLOUDRUN_SETUP.md) をご確認ください。

### 使い方

1. スプレッドシートのメニューから「記事自動生成」→「Search Console設定」
2. サイトURLと取得期間を設定
3. 「記事自動生成」→「🔍 Search Consoleからキーワード取得」をクリック
4. 「キーワード分析」シートにデータが出力される

### 活用方法

- SEO改善のターゲット選定（掲載順位5-15位のキーワード）
- タイトル改善（CTRが低いキーワード）
- 新規記事のネタ探し（関連キーワード、トレンドキーワード）
- 定期モニタリング（月次で実行して順位変動を把握）

---

## 注意事項

- OpenAI API の使用には料金がかかります（GPT-4o の場合、1記事あたり数十円～数百円程度）
- 生成される記事は約6,000文字程度で、画像も自動挿入されます
- 生成される記事は必ず人間が確認・編集してください
- Google API の利用規約に従ってください
- Search Console APIの使用には、サービスアカウントにサイトへのアクセス権限が必要です

## ライセンス

このプロジェクトはクライアント企業社内用です。
